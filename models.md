# Django Models and Migrations Tutorial
---

## 1. The "M" in Django's MVT Architecture

Django follows the **MVT (Model-View-Template)** design pattern:

- **Model**: Represents the data layer. It's responsible for defining and interacting with the database. Models act as Python classes that map to database tables.
- **View**: Handles business logic and interactions between the Model and Template. It processes requests and returns responses.
- **Template**: The presentation layer. It defines how the data is displayed to the user.

The **Model** is at the core of the architecture, as it defines the structure and relationships of your data. Django's ORM uses these models to interact with the database without requiring you to write raw SQL.

---

## 2. What is `models.py`?

The `models.py` file in a Django app is where you define your data structure. Each class in `models.py` represents a **database table**, and each attribute corresponds to a **column** in that table.

Django provides various field types like `CharField`, `IntegerField`, `DateField`, etc., to define the type of data you want to store.

### Example: A Simple Model

```python
from django.db import models

class Author(models.Model):
    name = models.CharField(max_length=100)
    email = models.EmailField(unique=True)
    age = models.IntegerField()

    def __str__(self):
        return self.name
```

**Explanation**:
- `name`: A `CharField` for storing text, limited to 100 characters.
- `email`: An `EmailField` with a unique constraint.
- `age`: An `IntegerField` for storing numeric values.

---

## 3. Django ORM and `models.py`

Django's ORM (Object-Relational Mapping) serves as a bridge between the Python objects in `models.py` and the database tables. It allows you to perform database operations using Python code rather than SQL.

### Example: ORM in Action

```python
# Create a new author
author = Author(name="Alice", email="alice@example.com", age=30)
author.save()

# Retrieve all authors
authors = Author.objects.all()

# Filter authors by name
alice = Author.objects.filter(name="Alice")
```

---

## 4. Migrations

### What are Migrations?

Migrations are Django's way of applying changes in `models.py` to the database schema. They ensure that your database structure matches your application's data models.

---

### 4.1 Creating Migrations

Whenever you modify `models.py`, create a migration file:

```bash
python manage.py makemigrations
```

This command generates a migration file in the `migrations` folder of your app. The file contains Python code that describes the changes to be applied.

---

### 4.2 Applying Migrations

Apply the migration to the database using:

```bash
python manage.py migrate
```

This command executes the SQL statements defined in the migration file to update the database.

---

### 4.3 Viewing SQL Statements

To inspect the SQL generated by a migration:

```bash
python manage.py sqlmigrate <app_name> <migration_number>
```

Example:

```bash
python manage.py sqlmigrate myapp 0001
```

This outputs the raw SQL that will be executed.

---

## 5. Relationships in `models.py`

Django supports different types of relationships between models:

---

### 5.1 One-to-One Relationship

Defines a one-to-one relationship where one record in a table is associated with one and only one record in another table.

```python
class Profile(models.Model):
    user = models.OneToOneField('auth.User', on_delete=models.CASCADE)
    bio = models.TextField()
```

**Effect on Database**:
- Adds a unique constraint to the foreign key column.

---

### 5.2 Many-to-One Relationship (ForeignKey)

Defines a many-to-one relationship where multiple records in one table can be associated with a single record in another table.

```python
class Book(models.Model):
    title = models.CharField(max_length=200)
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
```

**Effect on Database**:
- Adds a foreign key column (`author_id`) to the `Book` table.

---

### 5.3 Many-to-Many Relationship

Defines a many-to-many relationship where multiple records in one table can be associated with multiple records in another table.

```python
class Course(models.Model):
    name = models.CharField(max_length=100)
    students = models.ManyToManyField('auth.User')
```

**Effect on Database**:
- Creates an intermediate table to store the relationships.

---

## 6. Inspecting the Database Schema

Django provides a command to inspect the database schema and generate model definitions for existing databases:

```bash
python manage.py inspectdb
```

This is useful when you're working with an existing database and want to integrate it with a Django application.

---

## 7. Complete Workflow Example

### 7.1 Define Models

```python
class Category(models.Model):
    name = models.CharField(max_length=100)

class Product(models.Model):
    name = models.CharField(max_length=100)
    price = models.DecimalField(max_digits=10, decimal_places=2)
    category = models.ForeignKey(Category, on_delete=models.CASCADE)
```

### 7.2 Create and Apply Migrations

```bash
python manage.py makemigrations
python manage.py migrate
```

### 7.3 View Generated SQL

```bash
python manage.py sqlmigrate myapp 0001
```

---

## 8. Summary Table of Relationship Effects

| Relationship Type       | Django Field       | Effect on Database              |
|--------------------------|--------------------|----------------------------------|
| One-to-One              | `OneToOneField`   | Adds a unique foreign key.      |
| Many-to-One             | `ForeignKey`      | Adds a foreign key column.      |
| Many-to-Many            | `ManyToManyField` | Creates an intermediate table.  |

---

## 9. Additional Resources

- [Django Documentation: Models](https://docs.djangoproject.com/en/stable/topics/db/models/)
- [Django Documentation: Migrations](https://docs.djangoproject.com/en/stable/topics/migrations/)

---
